/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 13 11:55
*/
KISSY.add("waterfall/base",function(f,m,n){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function o(a,b,c,d){var g=f.makeArray(a),p={},h;if(g.length>0)h=setTimeout(function(){var k=+new Date;do{var r=g.shift();b.call(c,r)}while(g.length>0&&+new Date-k<50);if(g.length>0)h=setTimeout(arguments.callee,25);else d&&d.call(c,a)},25);else d&&f.later(d,0,false,c,[a]);p.stop=function(){if(h){clearTimeout(h);g=[]}};return p}function q(){var a=this._containerRegion;a&&this.get("container").width()===
a.width||this.adjust()}function l(){var a=this.get("container").width(),b=this.get("curColHeights");b.length=Math.max(parseInt(a/this.get("colWidth")),this.get("minColCount"));this._containerRegion={width:a};f.each(b,function(c,d){b[d]=0})}function i(a){a=j(a);for(var b=this.get("curColHeights"),c=this.get("container"),d=b.length,g=0,p=this._containerRegion,h=Number.MAX_VALUE,k=0;k<d;k++)if(b[k]<h){h=b[k];g=k}d||(h=0);d=Math.max(p.width-d*this.get("colWidth"),0)/2;a.css({left:g*this.get("colWidth")+
d,top:h});c.contains(a)||c.append(a);b[g]+=a.outerHeight(true);return a}var j=m.all;e.ATTRS={container:{setter:function(a){return j(a)}},curColHeights:{value:[]},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},colWidth:{}};f.extend(e,n,{isAdjusting:function(){return!!this._adjuster},_init:function(){q.call(this);this.__onResize=f.buffer(q,50,this);j(window).on("resize",this.__onResize)},adjust:function(a){var b=this,c=b.get("container").all(".ks-waterfall");b.isAdjusting()&&b._adjuster.stop();
l.call(b);return b._adjuster=o(c,i,b,function(){b.get("container").height(Math.max.apply(Math,b.get("curColHeights")));b._adjuster=0;a&&a.call(b)})},addItems:function(a,b){var c=this;c._adder=o(a,c._addItem,c,function(){c.get("container").height(Math.max.apply(Math,c.get("curColHeights")));c._adder=0;b&&b.call(c)});return c._adder},_addItem:function(a){this.get("curColHeights");this.get("container");a=i.call(this,a);var b=this.get("effect");b.effect&&a[b.effect](b.duration,undefined,b.easing)},destroy:function(){j(window).detach("resize",
this.__onResize)}});return e},{requires:["node","base"]});
KISSY.add("waterfall/loader",function(f,m,n){function e(){e.superclass.constructor.apply(this,arguments)}function o(){if(!this.__loading)if(this.isAdjusting())this.__onScroll();else{var i=this.get("container").offset().top,j=this.get("diff"),a=this.get("curColHeights");if(a.length)i+=Math.min.apply(Math,a);j+l(window).scrollTop()+l(window).height()>i&&q.call(this)}}function q(){function i(c){a.__loading=false;a.addItems(c)}function j(){a.__loading=false;l(window).detach("scroll",a.__onScroll)}var a=
this;this.get("container");a.__loading=true;var b=a.get("load");b&&b(i,j)}var l=m.all;e.ATTRS={diff:{getter:function(i){return i||0}}};f.extend(e,n,{_init:function(){e.superclass._init.apply(this,arguments);this.__onScroll=f.buffer(o,50,this);l(window).on("scroll",this.__onScroll);o.call(this)},destroy:function(){e.superclass.destroy.apply(this,arguments);l(window).detach("scroll",this.__onScroll)}});return e},{requires:["node","./base"]});
KISSY.add("waterfall",function(f,m,n){m.Loader=n;return m},{requires:["waterfall/base","waterfall/loader"]});
